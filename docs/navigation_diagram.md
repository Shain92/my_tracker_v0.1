# Блок-схема навигации приложения My Tracker

## Описание документа

Этот документ содержит блок-схему навигации между страницами приложения, описание каждой страницы и ссылки на файлы для использования в промптах при разработке.

---

## Блок-схема навигации

```
┌─────────────────┐
│   Запуск App    │
│  (main.dart)    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  AuthWrapper    │ ◄─── Проверка токена авторизации
│ (main.dart)     │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌─────────┐ ┌──────────┐
│  Login  │ │   Home   │
│ Screen  │ │  Screen  │
└────┬────┘ └────┬─────┘
     │           │
     │           │ (внутренняя навигация)
     │           ├──► TasksScreen
     │           ├──► SettingsScreen
     │           └──► HomeContent (default)
     │
     │ (регистрация)
     ▼
┌──────────────┐
│ Register     │
│ Screen       │
└──────┬───────┘
       │
       │ (после регистрации)
       ▼
┌──────────┐
│  Home    │
│ Screen   │
└──────────┘
```

---

## Описание страниц

### 1. AuthWrapper
**Файл:** `frontend/lib/main.dart` (строки 26-63)

**Описание:** Обертка для проверки авторизации при запуске приложения. Проверяет наличие токена доступа и перенаправляет пользователя на LoginScreen (если не авторизован) или HomeScreen (если авторизован).

**Навигация:**
- Если токен отсутствует → `LoginScreen`
- Если токен есть → `HomeScreen`

**Ключевые функции:**
- `_checkAuth()` - проверка наличия токена через `ApiService.getAccessToken()`

---

### 2. LoginScreen
**Файл:** `frontend/lib/screens/login_screen.dart`

**Описание:** Экран авторизации пользователя. Содержит форму входа с полями username и password. Использует glassmorphism дизайн с эффектом размытия фона.

**Навигация:**
- Успешный вход → `HomeScreen` (через `Navigator.pushReplacement`)
- Переход на регистрацию → `RegisterScreen` (через `Navigator.push`)

**Ключевые функции:**
- `_handleLogin()` - обработка входа через `ApiService.login()`
- Валидация формы (обязательные поля)

**UI элементы:**
- Поле ввода username
- Поле ввода password (скрытое)
- Кнопка "Войти"
- Ссылка "Нет аккаунта? Зарегистрироваться"
- Отображение ошибок входа

---

### 3. RegisterScreen
**Файл:** `frontend/lib/screens/register_screen.dart`

**Описание:** Экран регистрации нового пользователя. Содержит форму с полями username, password и confirm password. После успешной регистрации автоматически перенаправляет на HomeScreen.

**Навигация:**
- Успешная регистрация → `HomeScreen` (через `Navigator.pushReplacement`)

**Ключевые функции:**
- `_handleRegister()` - обработка регистрации через `ApiService.register()`
- Валидация формы:
  - Username обязателен
  - Password обязателен и минимум 6 символов
  - Confirm password должен совпадать с password

**UI элементы:**
- Поле ввода username
- Поле ввода password (скрытое)
- Поле подтверждения password (скрытое)
- Кнопка "Зарегистрироваться"
- Отображение ошибок регистрации

---

### 4. HomeScreen
**Файл:** `frontend/lib/screens/home_screen.dart`

**Описание:** Главная страница приложения после авторизации. Содержит боковое меню (AppSidebar) для навигации между разделами и заголовок с информацией о пользователе (GlassHeader). Адаптивный дизайн: на мобильных устройствах sidebar открывается через drawer, на десктопе отображается постоянно.

**Навигация:**
- Внутренняя навигация через `_selectedScreen`:
  - `'home'` → `_HomeContent` (приветственный экран)
  - `'tasks'` → `TasksScreen`
  - `'settings'` → `SettingsScreen`
- Выход → `LoginScreen` (через `_handleLogout()`)

**Ключевые функции:**
- `_loadUsername()` - загрузка имени пользователя из API или локального хранилища
- `_handleLogout()` - выход из системы через `ApiService.logout()`
- `_onMenuItemSelected()` - обработка выбора пункта меню
- `_buildCurrentScreen()` - отображение текущего экрана в зависимости от выбора

**UI компоненты:**
- `GlassHeader` - заголовок с именем пользователя и кнопкой выхода
- `AppSidebar` - боковое меню навигации
- Адаптивный layout (mobile/desktop)

---

### 5. TasksScreen
**Файл:** `frontend/lib/screens/tasks_screen.dart`

**Описание:** Экран задач. В настоящее время содержит только базовую структуру с градиентным фоном. Требует дальнейшей реализации функционала управления задачами.

**Навигация:**
- Открывается из `HomeScreen` через выбор пункта меню "tasks"

**Текущее состояние:**
- Базовый виджет с градиентным фоном
- Функционал задач не реализован (TODO)

---

### 6. SettingsScreen
**Файл:** `frontend/lib/screens/settings_screen.dart`

**Описание:** Страница настроек системы (для суперпользователей). Содержит секции с настройками управления пользователями и системными настройками. Каждая секция содержит карточки с различными опциями.

**Навигация:**
- Открывается из `HomeScreen` через выбор пункта меню "settings"

**Секции настроек:**
1. **Управление пользователями:**
   - Список пользователей (TODO)
   - Роли и права доступа (TODO)

2. **Системные настройки:**
   - Конфигурация базы данных (TODO)
   - Резервное копирование (TODO)

**UI компоненты:**
- `_SettingsSection` - секция настроек с заголовком и иконкой
- `_SettingsCard` - карточка настройки с описанием

---

## Ссылки на файлы для промптов

### Основные файлы навигации:
- `frontend/lib/main.dart` - точка входа, AuthWrapper
- `frontend/lib/screens/login_screen.dart` - экран входа
- `frontend/lib/screens/register_screen.dart` - экран регистрации
- `frontend/lib/screens/home_screen.dart` - главная страница
- `frontend/lib/screens/tasks_screen.dart` - экран задач
- `frontend/lib/screens/settings_screen.dart` - экран настроек

### Вспомогательные компоненты:
- `frontend/lib/widgets/app_sidebar.dart` - боковое меню навигации
- `frontend/lib/widgets/glass_header.dart` - заголовок с эффектом стекла
- `frontend/lib/services/api_service.dart` - сервис для работы с API
- `frontend/lib/theme/app_theme.dart` - тема приложения

---

## Примеры использования в промптах

### Для добавления новой страницы:
```
Создай новую страницу ProjectsScreen по аналогии с TasksScreen.
Добавь навигацию к ней из HomeScreen через AppSidebar.
Файл: frontend/lib/screens/projects_screen.dart
```

### Для модификации навигации:
```
Измени HomeScreen чтобы добавить новую страницу ReportsScreen.
Добавь пункт меню в AppSidebar и обработку в _buildCurrentScreen().
Ссылки: frontend/lib/screens/home_screen.dart, frontend/lib/widgets/app_sidebar.dart
```

### Для работы с API:
```
Реализуй загрузку задач в TasksScreen используя ApiService.
Ссылка на API сервис: frontend/lib/services/api_service.dart
Ссылка на экран: frontend/lib/screens/tasks_screen.dart
```

---

## Примечания

- Все навигационные переходы используют `Navigator.pushReplacement` для замены текущего экрана (кроме перехода Login → Register)
- Авторизация проверяется через токен, хранящийся в локальном хранилище
- При выходе из системы токен удаляется и происходит возврат на LoginScreen
- Адаптивный дизайн: sidebar отображается по-разному на мобильных и десктопных устройствах


