# Блок-схема навигации приложения My Tracker

## Описание документа

Этот документ содержит блок-схему навигации между страницами приложения в стандартном формате блок-схемы с использованием эталонных символов:
- **Овалы** - начало/конец процесса
- **Прямоугольники** - действия/процессы
- **Ромбы** - условия/решения
- **Стрелки** - направление потока

---

## Блок-схема навигации

```
                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │  Запуск App │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ AuthWrapper │
                    │ Проверка    │
                    │   токена    │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   Токен     │
                    │   есть?     │
                    └──┬──────┬───┘
                       │      │
                  НЕТ  │      │  ДА
                       │      │
        ┌──────────────┘      └──────────────┐
        │                                    │
        ▼                                    ▼
┌──────────────┐                    ┌──────────────┐
│ LoginScreen  │                    │  HomeScreen  │
│  (Вход)      │                    │  (Главная)   │
└──────┬───────┘                    └──────┬───────┘
       │                                    │
       │                                    │
       │  ┌─────────────────────────────┐   │
       │  │  Внутренняя навигация      │   │
       │  │  через AppSidebar:         │   │
       │  └─────────────────────────────┘   │
       │                                    │
       │                                    ├──► [home] → HomeContent
       │                                    │
       │                                    ├──► [tasks] → TasksScreen
       │                                    │
       │                                    ├──► [projects] → ProjectsListScreen
       │                                    │                    │
       │                                    │                    ├──► ProjectIdScreen
       │                                    │                    │        │
       │                                    │                    │        └──► SiteProjectsScreen
       │                                    │                    │
       │                                    │                    ├──► ProjectMaterialsScreen
       │                                    │                    │
       │                                    │                    └──► ProjectWorksScreen
       │                                    │
       │                                    ├──► [settings] → SettingsScreen
       │                                    │                    │
       │                                    │                    ├──► UsersListScreen
       │                                    │                    │
       │                                    │                    ├──► DepartmentsListScreen
       │                                    │                    │        │
       │                                    │                    │        └──► AccessPermissionsScreen
       │                                    │                    │
       │                                    │                    └──► StatusesListScreen
       │                                    │
       │                                    └──► [Выход] → LoginScreen
       │
       │
       │  ┌─────────────────────────────┐
       │  │  Успешный вход?             │
       │  └──┬──────────────────────┬───┘
       │     │                      │
       │  ДА │                      │ НЕТ
       │     │                      │
       │     ▼                      │
       │  ┌──────────────┐          │
       │  │ HomeScreen   │          │
       │  └──────────────┘          │
       │                            │
       │                            │ (остаться на LoginScreen)
       │                            │
       │                            ▼
       │                    ┌──────────────┐
       │                    │  Ошибка      │
       │                    │  входа       │
       │                    └──────────────┘
       │
       │
       │  ┌─────────────────────────────┐
       │  │  Кнопка "Регистрация"      │
       │  └──────────────┬──────────────┘
       │                 │
       │                 ▼
       │         ┌──────────────┐
       │         │RegisterScreen│
       │         │ (Регистрация)│
       │         └──────┬───────┘
       │                │
       │                │
       │         ┌──────┴───────┐
       │         │  Успешная    │
       │         │ регистрация? │
       │         └──┬───────┬───┘
       │            │       │
       │         ДА │       │ НЕТ
       │            │       │
       │            ▼       │
       │     ┌──────────────┐│
       │     │ HomeScreen   ││
       │     └──────────────┘│
       │                     │
       │                     ▼
       │             ┌──────────────┐
       │             │  Ошибка      │
       │             │ регистрации  │
       │             └──────────────┘
       │
       │
       └─────────────────────────────┘
                    │
                    ▼
            ┌──────────────┐
            │     КОНЕЦ    │
            └──────────────┘
```

---

## Легенда символов

| Символ | Назначение | Пример |
|--------|-----------|--------|
| `┌─┐` | Овал - Начало/Конец | НАЧАЛО, КОНЕЦ |
| `┌─┐` | Прямоугольник - Процесс | LoginScreen, HomeScreen |
| `┌─┐` | Ромб - Условие/Решение | Токен есть?, Успешный вход? |
| `→` | Стрелка - Направление потока | Переход между экранами |
| `│` | Вертикальная линия - Продолжение потока | |
| `├─` | Разветвление - Несколько путей | |

---

## Описание страниц

### 1. AuthWrapper
**Файл:** `frontend/lib/main.dart` (строки 26-63)

**Описание:** Обертка для проверки авторизации при запуске приложения.

**Логика:**
- Проверяет наличие токена через `ApiService.getAccessToken()`
- Если токен есть → `HomeScreen`
- Если токена нет → `LoginScreen`

---

### 2. LoginScreen
**Файл:** `frontend/lib/screens/login_screen.dart`

**Описание:** Экран авторизации пользователя.

**Навигация:**
- Успешный вход → `HomeScreen` (через `Navigator.pushReplacement`)
- Кнопка "Регистрация" → `RegisterScreen` (через `Navigator.push`)
- Ошибка входа → остаться на `LoginScreen` с сообщением об ошибке

**UI элементы:**
- Поле ввода username
- Поле ввода password (скрытое)
- Кнопка "Войти"
- Ссылка "Нет аккаунта? Зарегистрироваться"

---

### 3. RegisterScreen
**Файл:** `frontend/lib/screens/register_screen.dart`

**Описание:** Экран регистрации нового пользователя.

**Навигация:**
- Успешная регистрация → `HomeScreen` (через `Navigator.pushReplacement`)
- Ошибка регистрации → остаться на `RegisterScreen` с сообщением об ошибке

**UI элементы:**
- Поле ввода username
- Поле ввода password (скрытое)
- Поле подтверждения password (скрытое)
- Кнопка "Зарегистрироваться"

---

### 4. HomeScreen
**Файл:** `frontend/lib/screens/home_screen.dart`

**Описание:** Главная страница приложения после авторизации.

**Внутренняя навигация через AppSidebar:**
- `'home'` → `_HomeContent` (приветственный экран по умолчанию)
- `'tasks'` → `TasksScreen`
- `'projects'` → `ProjectsListScreen`
- `'settings'` → `SettingsScreen`
- Кнопка "Выход" → `LoginScreen` (через `_handleLogout()`)

**Особенности:**
- Проверка прав доступа перед переходом на страницы
- Сохранение текущего экрана в локальное хранилище
- Адаптивный дизайн (mobile/desktop)

---

### 5. TasksScreen
**Файл:** `frontend/lib/screens/tasks_screen.dart`

**Описание:** Экран задач.

**Навигация:**
- Открывается из `HomeScreen` через выбор пункта меню "tasks"

**Текущее состояние:**
- Базовый виджет с градиентным фоном
- Функционал задач не реализован (TODO)

---

### 6. ProjectsListScreen
**Файл:** `frontend/lib/screens/projects_list_screen.dart`

**Описание:** Экран списка проектов с разделами.

**Навигация:**
- Открывается из `HomeScreen` через выбор пункта меню "projects"
- Кнопка "ИД" → `ProjectIdScreen`
- Кнопка "Материалы" → `ProjectMaterialsScreen`
- Кнопка "Работы" → `ProjectWorksScreen`

**UI элементы:**
- Grid с тремя карточками разделов
- Адаптивный layout (mobile/tablet/desktop)

---

### 7. ProjectIdScreen
**Файл:** `frontend/lib/screens/project_id_screen.dart`

**Описание:** Экран списка строительных участков.

**Навигация:**
- Открывается из `ProjectsListScreen` через кнопку "ИД"
- Выбор участка → `SiteProjectsScreen`
- Кнопка "Добавить участок" → `ConstructionSiteFormDialog`

---

### 8. SiteProjectsScreen
**Файл:** `frontend/lib/screens/site_projects_screen.dart`

**Описание:** Экран проектов конкретного строительного участка.

**Навигация:**
- Открывается из `ProjectIdScreen` при выборе участка
- Выбор проекта → `ProjectDetailScreen`

---

### 9. ProjectMaterialsScreen
**Файл:** `frontend/lib/screens/project_materials_screen.dart`

**Описание:** Экран управления материалами проекта.

**Навигация:**
- Открывается из `ProjectsListScreen` через кнопку "Материалы"

**Функционал:**
- CRUD операции с материалами
- Фильтрация и поиск

---

### 10. ProjectWorksScreen
**Файл:** `frontend/lib/screens/project_works_screen.dart`

**Описание:** Экран управления работами проекта.

**Навигация:**
- Открывается из `ProjectsListScreen` через кнопку "Работы"

**Функционал:**
- CRUD операции с работами
- Фильтрация и поиск

---

### 11. SettingsScreen
**Файл:** `frontend/lib/screens/settings_screen.dart`

**Описание:** Страница настроек системы.

**Навигация:**
- Открывается из `HomeScreen` через выбор пункта меню "settings"
- Карточка "Список пользователей" → `UsersListScreen`
- Карточка "Отделы" → `DepartmentsListScreen`
- Карточка "Статусы" → `StatusesListScreen`

**Особенности:**
- Доступ только для суперпользователей или пользователей с соответствующими правами
- Проверка прав доступа перед отображением карточек

---

### 12. UsersListScreen
**Файл:** `frontend/lib/screens/users_list_screen.dart`

**Описание:** Экран списка пользователей системы.

**Навигация:**
- Открывается из `SettingsScreen` через карточку "Список пользователей"

**Функционал:**
- Просмотр списка пользователей
- Пагинация
- Обновление списка (pull-to-refresh)

---

### 13. DepartmentsListScreen
**Файл:** `frontend/lib/screens/departments_list_screen.dart`

**Описание:** Экран списка отделов.

**Навигация:**
- Открывается из `SettingsScreen` через карточку "Отделы"
- Кнопка "Настройки доступа" → `AccessPermissionsScreen`
- Кнопка "Добавить отдел" → `DepartmentFormDialog`

**Функционал:**
- CRUD операции с отделами
- Управление правами доступа отделов

---

### 14. AccessPermissionsScreen
**Файл:** `frontend/lib/screens/access_permissions_screen.dart`

**Описание:** Экран настройки прав доступа отделов к страницам.

**Навигация:**
- Открывается из `DepartmentsListScreen` через кнопку "Настройки доступа"

**Функционал:**
- Настройка доступа отделов к различным страницам приложения

---

### 15. StatusesListScreen
**Файл:** `frontend/lib/screens/statuses_list_screen.dart`

**Описание:** Экран списка статусов.

**Навигация:**
- Открывается из `SettingsScreen` через карточку "Статусы"

**Функционал:**
- CRUD операции со статусами

---

## Ссылки на файлы для промптов

### Основные файлы навигации:
- `frontend/lib/main.dart` - точка входа, AuthWrapper
- `frontend/lib/screens/login_screen.dart` - экран входа
- `frontend/lib/screens/register_screen.dart` - экран регистрации
- `frontend/lib/screens/home_screen.dart` - главная страница
- `frontend/lib/screens/tasks_screen.dart` - экран задач
- `frontend/lib/screens/projects_list_screen.dart` - список проектов
- `frontend/lib/screens/settings_screen.dart` - экран настроек

### Вспомогательные компоненты:
- `frontend/lib/widgets/app_sidebar.dart` - боковое меню навигации
- `frontend/lib/widgets/glass_header.dart` - заголовок с эффектом стекла
- `frontend/lib/services/api_service.dart` - сервис для работы с API
- `frontend/lib/theme/app_theme.dart` - тема приложения

---

## Примечания

- Все навигационные переходы используют `Navigator.pushReplacement` для замены текущего экрана (кроме перехода Login → Register)
- Авторизация проверяется через токен, хранящийся в локальном хранилище
- При выходе из системы токен удаляется и происходит возврат на LoginScreen
- Адаптивный дизайн: sidebar отображается по-разному на мобильных и десктопных устройствах
- Права доступа проверяются перед переходом на страницы и перед отображением элементов меню
