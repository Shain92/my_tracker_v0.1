<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Блок-схема навигации My Tracker</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network@latest/standalone/umd/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            overflow: hidden;
        }

        #network {
            width: 100vw;
            height: 100vh;
            background: #ffffff;
        }

        .copy-tooltip {
            position: fixed;
            background: rgba(26, 26, 46, 0.95);
            color: #4fc3f7;
            padding: 12px 18px;
            border-radius: 8px;
            border: 2px solid #4fc3f7;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(79, 195, 247, 0.5);
            display: none;
            backdrop-filter: blur(10px);
            max-width: 300px;
            line-height: 1.5;
            font-family: 'Courier New', monospace;
        }

        .copy-tooltip.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="copy-tooltip" id="copyTooltip">✓ Скопировано!</div>
    <div id="network"></div>

    <script>
        // Карта соответствий элементов схемы и файлов
        const nodeFileMap = {
            'AuthWrapper': 'frontend/lib/main.dart (26-63)',
            'LoginScreen': 'frontend/lib/screens/login_screen.dart',
            'RegisterScreen': 'frontend/lib/screens/register_screen.dart',
            'HomeScreen': 'frontend/lib/screens/home_screen.dart',
            'HomeContent': 'frontend/lib/screens/home_screen.dart',
            'TasksScreen': 'frontend/lib/screens/tasks_screen.dart',
            'ProjectsListScreen': 'frontend/lib/screens/projects_list_screen.dart',
            'ProjectIdScreen': 'frontend/lib/screens/project_id_screen.dart',
            'SiteProjectsScreen': 'frontend/lib/screens/site_projects_screen.dart',
            'ProjectDetailScreen': 'frontend/lib/screens/project_detail_screen.dart',
            'ProjectMaterialsScreen': 'frontend/lib/screens/project_materials_screen.dart',
            'ProjectWorksScreen': 'frontend/lib/screens/project_works_screen.dart',
            'SettingsScreen': 'frontend/lib/screens/settings_screen.dart',
            'UsersListScreen': 'frontend/lib/screens/users_list_screen.dart',
            'DepartmentsListScreen': 'frontend/lib/screens/departments_list_screen.dart',
            'AccessPermissionsScreen': 'frontend/lib/screens/access_permissions_screen.dart',
            'StatusesListScreen': 'frontend/lib/screens/statuses_list_screen.dart'
        };

        // Узлы
        const nodes = new vis.DataSet([
            { id: 1, label: 'НАЧАЛО', shape: 'ellipse', color: { background: '#4fc3f7', border: '#29b6f6' }, font: { size: 16, bold: true } },
            { id: 2, label: 'AuthWrapper\nПроверка токена', shape: 'box', color: { background: '#81d4fa', border: '#4fc3f7' }, file: nodeFileMap['AuthWrapper'] },
            { id: 3, label: 'Токен\nесть?', shape: 'diamond', color: { background: '#ff9800', border: '#f57c00' } },
            { id: 4, label: 'LoginScreen\nЭкран входа', shape: 'box', color: { background: '#ef5350', border: '#e53935' }, file: nodeFileMap['LoginScreen'] },
            { id: 5, label: 'Успешный\nвход?', shape: 'diamond', color: { background: '#ff9800', border: '#f57c00' } },
            { id: 6, label: 'Ошибка входа', shape: 'box', color: { background: '#b0bec5', border: '#90a4ae' } },
            { id: 7, label: 'Кнопка\nРегистрация', shape: 'box', color: { background: '#b0bec5', border: '#90a4ae' } },
            { id: 8, label: 'RegisterScreen\nЭкран регистрации', shape: 'box', color: { background: '#ef5350', border: '#e53935' }, file: nodeFileMap['RegisterScreen'] },
            { id: 9, label: 'Успешная\nрегистрация?', shape: 'diamond', color: { background: '#ff9800', border: '#f57c00' } },
            { id: 10, label: 'Ошибка регистрации', shape: 'box', color: { background: '#b0bec5', border: '#90a4ae' } },
            { id: 11, label: 'HomeScreen\nГлавная страница', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['HomeScreen'] },
            { id: 12, label: 'Внутренняя\nнавигация', shape: 'diamond', color: { background: '#ff9800', border: '#f57c00' } },
            { id: 13, label: 'HomeContent', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['HomeContent'] },
            { id: 14, label: 'TasksScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['TasksScreen'] },
            { id: 15, label: 'ProjectsListScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['ProjectsListScreen'] },
            { id: 16, label: 'SettingsScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['SettingsScreen'] },
            { id: 17, label: 'Кнопка Выход', shape: 'box', color: { background: '#b0bec5', border: '#90a4ae' } },
            { id: 18, label: 'ProjectIdScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['ProjectIdScreen'] },
            { id: 19, label: 'ProjectMaterialsScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['ProjectMaterialsScreen'] },
            { id: 20, label: 'ProjectWorksScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['ProjectWorksScreen'] },
            { id: 21, label: 'SiteProjectsScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['SiteProjectsScreen'] },
            { id: 22, label: 'ProjectDetailScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['ProjectDetailScreen'] },
            { id: 23, label: 'UsersListScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['UsersListScreen'] },
            { id: 24, label: 'DepartmentsListScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['DepartmentsListScreen'] },
            { id: 25, label: 'AccessPermissionsScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['AccessPermissionsScreen'] },
            { id: 26, label: 'StatusesListScreen', shape: 'box', color: { background: '#66bb6a', border: '#4caf50' }, file: nodeFileMap['StatusesListScreen'] }
        ]);

        // Рёбра
        const edges = new vis.DataSet([
            { from: 1, to: 2, arrows: 'to' },
            { from: 2, to: 3, arrows: 'to' },
            { from: 3, to: 4, label: 'НЕТ', arrows: 'to' },
            { from: 3, to: 11, label: 'ДА', arrows: 'to' },
            { from: 4, to: 5, arrows: 'to' },
            { from: 5, to: 11, label: 'ДА', arrows: 'to' },
            { from: 5, to: 6, label: 'НЕТ', arrows: 'to' },
            { from: 4, to: 7, arrows: 'to' },
            { from: 7, to: 8, arrows: 'to' },
            { from: 8, to: 9, arrows: 'to' },
            { from: 9, to: 11, label: 'ДА', arrows: 'to' },
            { from: 9, to: 10, label: 'НЕТ', arrows: 'to' },
            { from: 11, to: 12, arrows: 'to' },
            { from: 12, to: 13, arrows: 'to' },
            { from: 12, to: 14, arrows: 'to' },
            { from: 12, to: 15, arrows: 'to' },
            { from: 12, to: 16, arrows: 'to' },
            { from: 12, to: 17, arrows: 'to' },
            { from: 17, to: 4, arrows: 'to' },
            { from: 15, to: 18, arrows: 'to' },
            { from: 15, to: 19, arrows: 'to' },
            { from: 15, to: 20, arrows: 'to' },
            { from: 18, to: 21, arrows: 'to' },
            { from: 21, to: 22, arrows: 'to' },
            { from: 16, to: 23, arrows: 'to' },
            { from: 16, to: 24, arrows: 'to' },
            { from: 16, to: 26, arrows: 'to' },
            { from: 24, to: 25, arrows: 'to' }
        ]);

        // Данные для визуализации
        const data = {
            nodes: nodes,
            edges: edges
        };

        // Настройки
        const options = {
            nodes: {
                shape: 'box',
                font: {
                    size: 14,
                    face: 'Segoe UI',
                    bold: true
                },
                borderWidth: 3,
                shadow: true
            },
            edges: {
                arrows: {
                    to: {
                        enabled: true,
                        scaleFactor: 1.2
                    }
                },
                font: {
                    size: 12,
                    align: 'middle'
                },
                color: {
                    color: '#4fc3f7',
                    highlight: '#29b6f6'
                },
                smooth: {
                    type: 'continuous',
                    roundness: 0.5
                }
            },
            layout: {
                hierarchical: {
                    enabled: true,
                    direction: 'UD',
                    sortMethod: 'directed',
                    levelSeparation: 150,
                    nodeSpacing: 200,
                    treeSpacing: 300,
                    blockShifting: true,
                    edgeMinimization: true,
                    parentCentralization: true
                }
            },
            physics: {
                enabled: false
            },
            interaction: {
                zoomView: true,
                dragView: true,
                dragNodes: true,
                selectConnectedEdges: false
            }
        };

        // Создание сети
        const container = document.getElementById('network');
        const network = new vis.Network(container, data, options);

        // Обработка клика на узел
        network.on('click', function(params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const node = nodes.get(nodeId);
                const file = node.file;
                
                if (file) {
                    copyToClipboard(file, params.event);
                }
            }
        });

        // Подсветка при наведении
        network.on('hoverNode', function(params) {
            const node = nodes.get(params.node);
            if (node.file) {
                container.style.cursor = 'pointer';
            }
        });

        network.on('blurNode', function() {
            container.style.cursor = 'default';
        });

        // Функция копирования в буфер обмена
        function copyToClipboard(text, event) {
            navigator.clipboard.writeText(text).then(() => {
                showTooltip(`✓ Скопировано!\n${text}`, event);
            }).catch(err => {
                // Fallback для старых браузеров
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showTooltip(`✓ Скопировано!\n${text}`, event);
                } catch (e) {
                    alert('Не удалось скопировать. Скопируйте вручную: ' + text);
                }
                document.body.removeChild(textArea);
            });
        }

        function showTooltip(message, event) {
            const tooltip = document.getElementById('copyTooltip');
            tooltip.textContent = message;
            if (event && event.center) {
                tooltip.style.left = (event.center.x + 15) + 'px';
                tooltip.style.top = (event.center.y - 15) + 'px';
            } else {
                tooltip.style.left = '50%';
                tooltip.style.top = '50%';
                tooltip.style.transform = 'translate(-50%, -50%)';
            }
            tooltip.classList.add('show');
            
            setTimeout(() => {
                tooltip.classList.remove('show');
            }, 2500);
        }

        // Автоматическое масштабирование при загрузке
        network.on('stabilizationEnd', function() {
            network.fit({
                animation: {
                    duration: 500,
                    easingFunction: 'easeInOutQuad'
                }
            });
        });
    </script>
</body>
</html>
